---
title: "Untitled"
output: html_document
date: "2022-12-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
amex_full<-arrow::read_feather("~/Downloads/amex-default-prediction/amex-data.feather")
target1<-read_csv("~/Downloads/amex-default-prediction/train_labels.csv")

amex_full<-amex_full %>% mutate(month=month(as.POSIXct(S_2,tryFormats = "%Y-%m-%d")),year=year(as.POSIXct(S_2,tryFormats = "%Y-%m-%d"))) 
altos_na<-amex_full %>% lapply(is.na) %>% lapply(mean) %>% data.frame() %>% t()
colnames(altos_na)<-c("porc_na")
altos_na<-altos_na%>%data.frame()%>%filter(porc_na>0.9) %>% rownames()
```
Como resultado, no se incluyeron 18 variables que tenían más de 90% de sus entradas con NA.

De este subset se procedió a calcular la matriz de correlación para descartar variables con correlaciones cercanas a uno.

```{r}
amex_subset<-amex_full %>% select(-all_of(altos_na)) %>% select(customer_ID,S_2,month,year,contains("B")) %>% left_join(target1) %>%mutate(target=as.factor(target),month=as.factor(month)) 

#amex_subset %>%ggplot(aes(x=.panel_x,y=.panel_y,fill=target,group=month)) + geom_boxplot() + facet_matrix(rows=vars(B_1:B_41),cols=vars(month),switch="y")
```

```{r}
amex_agrupado <-amex_subset %>% unite("Per",month:year)
aggregate(.~Per+target,amex_agrupado,mean)

amex_agrupado %>% group_by(Per,target)  %>% summarise(B_avg = mean(B_15, na.rm=TRUE)) #%>%  ggplot(aes(x=Per, y=B_avg, color=target)) + geom_line() + ylab("Mean") + theme_bw() + theme(plot.title = element_text(hjust = 0.5)) + ggtitle("B_1") + labs(colour = "Target")

```

```{r}
nombres1<-colnames(amex_subset)
for(i in nombres1){
  amex_subset %>% ggplot(aes(x=month,y=nombres1[],color=target)) +geom_boxplot()
}

```


## Análisis exploratorio de datos (EDA)

Para iniciar el análisis exploratorio de los datos, nos enfocamos en variables con 1) información distinta a NA en al menos 10% de las entradas y 2) que no tuvieran una correlación cercana a uno con otras variables (cuando la correlación entre dos variables era alta se ecogió la variable con mayor información)